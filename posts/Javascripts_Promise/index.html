<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="[JavaScript for Alexa Skill Development] Chapter 13: Asynchronous features" /><meta property="og:locale" content="en" /><meta name="description" content="Good reference, this Blog." /><meta property="og:description" content="Good reference, this Blog." /><link rel="canonical" href="https://yanxuceo.github.io/posts/Javascripts_Promise/" /><meta property="og:url" content="https://yanxuceo.github.io/posts/Javascripts_Promise/" /><meta property="og:site_name" content="Xu’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-06T08:40:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[JavaScript for Alexa Skill Development] Chapter 13: Asynchronous features" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-01-06T08:40:00+01:00","datePublished":"2023-01-06T08:40:00+01:00","description":"Good reference, this Blog.","headline":"[JavaScript for Alexa Skill Development] Chapter 13: Asynchronous features","mainEntityOfPage":{"@type":"WebPage","@id":"https://yanxuceo.github.io/posts/Javascripts_Promise/"},"url":"https://yanxuceo.github.io/posts/Javascripts_Promise/"}</script><title>[JavaScript for Alexa Skill Development] Chapter 13: Asynchronous features | Xu's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Xu's Blog"><meta name="application-name" content="Xu's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"> <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/lego_set.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Xu's Blog</a></div><div class="site-subtitle font-italic">Share my ideas and record my learning.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><ul class="w-100"><div style="text-align: left; margin-top: 1%; margin-left: 11%;"> <span id="busuanzi_container_site_pv" style="color:#aaa"> <i class="fa fa-paw"></i> views: <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span> </span></div><div style="text-align: left; margin-left: 11%;"> <span id="busuanzi_container_site_uv" style="color:#aaa"> <i class="fa fa-user"></i> visitors: <span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span> </span></div></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/yanxuceo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['yanxuceo','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[JavaScript for Alexa Skill Development] Chapter 13: Asynchronous features</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><h1 data-toc-skip>[JavaScript for Alexa Skill Development] Chapter 13: Asynchronous features</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1672990800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 6, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/yanxuceo">xu dong</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1841 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p>Good reference, this <a href="https://es6.ruanyifeng.com/#docs/promise"><span style="color:#3ababa">Blog</span></a>.</p><p>Contents from this book <a href="https://www.oreilly.com/library/view/javascript-the-definitive/9781491952016/"><span style="color:#3ababa">JavaScript: The Definitive Guide, 7th Edition</span></a> channel.</p><p><span style="color:#3ababa">Promises</span> are objects that represent the not-yet-available result of an asynchronous operation. The keywords <span style="color:#3ababa">async</span> and <span style="color:#3ababa">await</span> simplify asynchronous programming by allowing you to structure your Promise-based code as if it was synchronous. Finally, the <span style="color:#3ababa">for/await</span> loop allow you to work with streams of asynchronous events using simple loops that appear synchronous.</p><h2 id="1-asynchronous-progamming-with-callbacks"><span class="mr-2">1. Asynchronous Progamming with Callbacks</span><a href="#1-asynchronous-progamming-with-callbacks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A callback is a function that you write and then pass to some other function. That other function then invokes your function when some condition is met or some synchronous event occurs.</p><h3 id="timers"><span class="mr-2">Timers</span><a href="#timers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>setTimeout(checkForUpdates, 60000);
</pre></table></code></div></div><h3 id="events"><span class="mr-2">Events</span><a href="#events" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Client-side JavaScript programs are almost universally event driven: rather than running some kind of predetermined computation, they typically wait for the user to do something and then respond to the user’s actions.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>let okay = document.querySelector('#confirmUpdateDialogbutton.okay');

// Now register a callback function to be invoked when the user clicks on that button.
okay.addEventListener('click', applyUpdate);
</pre></table></code></div></div><h3 id="network-events"><span class="mr-2">Network Events</span><a href="#network-events" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Another common source of asynchrony in JavaScript programming is network requests.</p><p><img data-src="/assets/img/JavaScript/network_callback_example_0.PNG" alt="network callback example" width="400" data-proofer-ignore> <br /></p><p>getCurrentVersionNumber() makes an asynchronous request, it cannot synchronously return the value that the caller is interested in. Instead, the caller passes a callback function, which is invoked when the result is ready or when an error occurs.</p><h3 id="callbacks-and-events-in-node"><span class="mr-2">Callbacks and Events in Node</span><a href="#callbacks-and-events-in-node" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Node.js asynchronous example: reading the contents of a file. fs.readFile() takes a two-parameter callback as its last argument.</p><p><img data-src="/assets/img/JavaScript/network_callback_example_1.PNG" alt="network callback example" width="400" data-proofer-ignore> <br /></p><p>Example to request for the contents of a URL in Node. Node uses <span style="color:#3ababa">on()</span> method to register event listeners instead of <span style="color:#3ababa">addEventListener()</span>.</p><p><img data-src="/assets/img/JavaScript/network_callback_example_2.PNG" alt="network callback example" width="400" data-proofer-ignore> <img data-src="/assets/img/JavaScript/network_callback_example_3.PNG" alt="network callback example" width="400" data-proofer-ignore> <br /></p><h2 id="2-promises"><span class="mr-2">2. Promises</span><a href="#2-promises" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>所谓Promise，简单说就是一个容器，里面保存着某个未来才会结束的事件（通常是一个异步操作）的结果。从语法上说，Promise 是一个对象，从它可以获取异步操作的消息。</p><p>A Promise is an object that represents the result of an asynchronous computation. That result may or may not be ready yet, and the Promise API is intentionally vague about this: there is no way to synchronously get the value of a Promise; you can only ask the Promise to call a callback function when the value is ready. <br /></p><p>To make it Promise-based, omit the callback argument, and instead return a Promise object. The caller can then register one or more callbacks on this Promise object, and they will be invoked when the asynchronous computation is done. <br /></p><p>callbacks drawbacks:</p><ul><li>nested callback, not clean<li>difficult error handlings</ul><h3 id="using-promises"><span class="mr-2">Using Promises</span><a href="#using-promises" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The function you pass to <span style="color:#3ababa">then()</span> is invoked asynchronously, even if the asynchronous computation is already complete when you call <span style="color:#3ababa">then()</span>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>getJSON(url).then(jsonData =&gt; {
    // This is a callback function that will be asynchronously
    // invoked with the parsed JSON value when it becomes available.
});
</pre></table></code></div></div><p><img data-src="/assets/img/JavaScript/promise_example_0.PNG" alt="promise example" width="400" data-proofer-ignore></p><p><em>Handling Errors with Promises</em> <br /> Callback vs. Promise <br /> When something goes wrong in a synchronous computation, it throws an exception that propagates up the call stack until there is a catch clause to handle it. When an asynchronous computation runs, its caller is no longer on the stack, so if something goes wrong, it is simply not possible to throw an exception back to the caller.</p><p>Asynchronous operations can fail in a number of ways, and robust code has to be written to handle the errors that will inevitably occur. When a Promise-based asynchronous computation completes normally, it passes its result to the function that is the first argument to <span style="color:#3ababa">then()</span>. For Promises, we can do this by passing a second function to the <span style="color:#3ababa">then()</span> method for error handling.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>getJSON("/api/user/profile").then(displayUserProfile, handleProfileError);
</pre></table></code></div></div><p><img data-src="/assets/img/JavaScript/promise_example_1.PNG" alt="promise example" width="400" data-proofer-ignore></p><p><em>Promise Terminology</em> we say that the Promise has been <span style="color:#3ababa">fulfilled</span> if and when the first callback is called; we say that the Promise has been <span style="color:#3ababa">rejected</span> if and when the second callback is called; if a Promise is neither fulfilled nor rejected, then it is <span style="color:#3ababa">pending</span>. And once a promise is fulfilled or rejected, we say that it is <span style="color:#3ababa">settled</span>.</p><h3 id="chaining-promises"><span class="mr-2">Chaining Promises</span><a href="#chaining-promises" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Promise provides a natural way to express a sequence of asynchronous operations as a linear chain of <span style="color:#3ababa">then()</span> method invocations, without having to nest each operation within the callback of the previous one. <br /></p><p>Example to illustrate how a chain of Promises can make it easy to express a sequence of asynchronous operations</p><p><img data-src="/assets/img/JavaScript/promise_example_2.PNG" alt="promise example" width="400" data-proofer-ignore></p><p>Method chain example:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>fetch().then().then()
</pre></table></code></div></div><p>We know that the <span style="color:#3ababa">fetch()</span> function returns a Promise object, and we can see that the first <span style="color:#3ababa">.then()</span> in this chain invokes a method on that returned Promise object. But there is a second <span style="color:#3ababa">.then()</span> in the chain, which means that the first invocation of the then() method must itself return a Promise.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>fetch(theURL)           // task 1; returns promise 1
    .then(callback1)    // task 2; returns promise 2
    .then(callback2);   // task 3; returns promise 3
</pre></table></code></div></div><p>But just because task 2 begins when c1 is invoked, it does not mean that task 2 must end when c1 returns. Promises are about managing asynchronous tasks, after all, and if task 2 is asynchronous (which it is, in this case), then that task will not be complete by the time the callback returns.</p><p><img data-src="/assets/img/JavaScript/promise_example_4.PNG" alt="promise example" width="400" data-proofer-ignore></p><p>About <span style="color:#3ababa">resolved</span>:</p><p><img data-src="/assets/img/JavaScript/promise_example_3.PNG" alt="promise example" width="400" data-proofer-ignore></p><h3 id="promises-in-parallel"><span class="mr-2">Promises in Parallel</span><a href="#promises-in-parallel" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Sometimes we want to execute a number of asynchronous operations on parallel.</p><h3 id="making-promises"><span class="mr-2">Making Promises</span><a href="#making-promises" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This section shows how you can create your own Promise-based APIs.</p><h4 id="promises-based-on-other-promises"><span class="mr-2">Promises Based On Other Promises</span><a href="#promises-based-on-other-promises" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Given a Promise, you can always create a new one by calling <span style="color:#3ababa">.then()</span>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>//Promise returned by getJSON() resolves to the Promise returned by response.json(). 
function getJSON(url) {
    return fetch(url).then(response =&gt; response.json());
}
</pre></table></code></div></div><h4 id="promises-based-on-synchronous-values"><span class="mr-2">Promises Based On Synchronous Values</span><a href="#promises-based-on-synchronous-values" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Sometimes, you may need to implement an existing Promise-based API and return a Promise from a function, even though the computation to be performed does not actually require any asynchronous operations. <br /></p><p><span style="color:#3ababa">Promise.resolve()</span> and <span style="color:#3ababa">Promise.reject()</span></p><p>Promise.resolve() takes a value as its single argument and returns a Promise that will immediately(but asynchronously) be fulfilled to that value.</p><p><em>To be clear</em>: <br /> The Promises returned by these static methods are not already fulfilled or rejected when they are returned, but they will fulfill or reject immediately after the current synchronous chunk of code has finished running. Typically, this happens within a few milliseconds unless there are many pending asynchronous tasks waiting to run. <br /></p><p>It is fairly common to have synchronous special cases within an asynchronous function, and you can handle these special cases with Promise.resolve() and Promise.reject().</p><h4 id="promises-from-scratch"><span class="mr-2">Promises from Scratch</span><a href="#promises-from-scratch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>what about writing a Promise-returning function when you can’t use another Promise-returning function as the starting point? In that case, you use the <span style="color:#3ababa">Promise()</span> constructor to create a new Promise object that you have complete control over.</p><p>Alexa skill example:</p><p><img data-src="/assets/img/JavaScript/promise_example_5.PNG" alt="promise example" width="500" data-proofer-ignore></p><p>Pay attension:</p><p><img data-src="/assets/img/JavaScript/promise_example_8.PNG" alt="promise example" width="400" data-proofer-ignore></p><p>The constructor synchronously calls your function with function arguments for the <span style="color:#3ababa">resolve</span> and <span style="color:#3ababa">reject</span> parameters. After calling your function, the <span style="color:#3ababa">Promise()</span> constructors returns the newly created Promise. That returned Promise is under the control of the function you passed to the contructor.</p><p>That function should perform some asynchronous operation and then call the <span style="color:#3ababa">resolve</span> function to resolve or fulfill the returned Promise or call the <span style="color:#3ababa">reject</span> function to reject the returned Promise.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>function wait(duration) {
    // Create and return a new Promise
    return new Promise((resolve, reject) =&gt; {   // These control the Promise
                                                // If the argument is invalid, reject the Promise
        if (duration &lt; 0) {
            reject(new Error("Time travel not yet implemented"));
        }

        // Otherwise, wait asynchronously and then resolve the Promise.
        // setTimeout will invoke resolve() with no arguments, which means
        // that the Promise will fulfill with the undefined value.
        setTimeout(resolve, duration);
    });
}
</pre></table></code></div></div><p>This getJSON() example illustrates how we can implement Promise-based APIs on top of other styles of asynchronous programming.</p><p><img data-src="/assets/img/JavaScript/promise_example_6.PNG" alt="promise example" width="500" data-proofer-ignore> <img data-src="/assets/img/JavaScript/promise_example_7.PNG" alt="promise example" width="500" data-proofer-ignore></p><h3 id="promises-in-sequence"><span class="mr-2">Promises in Sequence</span><a href="#promises-in-sequence" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h2 id="3-async-and-await"><span class="mr-2">3. async and await</span><a href="#3-async-and-await" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>These new keywords dramatically simplify the use of Promises and allow us to write Promise-based, asynchronous code that look like synchronous code that blocks while waiting for network response or other asynchronous events.</p><h3 id="await-expressions"><span class="mr-2">await Expressions</span><a href="#await-expressions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The <span style="color:#3ababa">await</span> keyword takes a Promise and turns it back into a return value or a thrown exception. Given a Promise object p, the <span style="color:#3ababa">await p</span> waits until p settels. If p fulfills, then the value of <span style="color:#3ababa">await p</span> is the fulfillment value of p. If p is rejected, then the <span style="color:#3ababa">await p</span> throws the rejection value of p. <br /></p><p>It literally does nothing until the specified Promise settles. The code remains asynchronous, and the await simply disguises this fact. This means that any code that uses await is itself asynchronous.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>let response = await fetch("/api/user/profile");
let profile = await response.json();
</pre></table></code></div></div><h3 id="async-functions"><span class="mr-2">async Functions</span><a href="#async-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Because any code that uses <span style="color:#3ababa">await</span> is asynchronous, there is one critical rule: you can only use the <span style="color:#3ababa">await</span> keyword within functions that have been declared with the <span style="color:#3ababa">async</span> keyword. <br /></p><p>Declaring a function <span style="color:#3ababa">async</span> means that the return value of the function will be a <span style="color:#3ababa">Promise</span> even if no Promise-related code appears in the body of the function.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>async function getHighScore() {
    let response = await fetch("/api/user/profile");
    let profile = await response.json();
    return profile.highScore;
}
</pre></table></code></div></div><p>The getHighScore() function is declared async, so it returns a Promise. And because it returns a Promise, we can use the await keyword with it:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>displayHighScore(await getHighScore());
</pre></table></code></div></div><h3 id="awaiting-multiple-promises"><span class="mr-2">Awaiting Multiple Promises</span><a href="#awaiting-multiple-promises" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Given this getJSON() function:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>async function getJSON(url) {
    let response = await fetch(url);
    let body = await response.json();
    return body;
}
</pre></table></code></div></div><p>Now suppose we want to fetch two JSON values with this function:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>let value1 = await getJSON(url1);
let value2 = await getJSON(url2);
</pre></table></code></div></div><p><em>Issue</em>: <br /> It is unnecessarily sequential: the fetch of the second URL will not begin until the first fetch is complete. If the second URL does not depend on the value obtained from the first URL, then we should probably try to fetch the two values at the same time. <br /></p><p><em>Solution</em>: <br /> In order to await a set of concurrently executing <span style="color:#3ababa">async</span> functions, we use <span style="color:#3ababa">Promise.all()</span> just as we would if working with Promises directly:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>let [value1, value2] = await Promise.all([getJSON(url1), getJSON(url2)]);
</pre></table></code></div></div><h3 id="implementation-details"><span class="mr-2">Implementation details</span><a href="#implementation-details" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To think about what is going on under the hood. Suppose you write an <span style="color:#3ababa">async</span> like this:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>async function f(x) { /* body */ }
</pre></table></code></div></div><p>You can think of this as a Promise-returning function wrapped around the body of your original function:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>function f(x) {
    return new Promise(function(resolve, reject) {
        try {
            resolve((function(x) { /* body */ })(x));
        }
        catch(e) {
            reject(e);
        }
    });
}
</pre></table></code></div></div><h2 id="4-asynchronous-iteration"><span class="mr-2">4. Asynchronous iteration</span><a href="#4-asynchronous-iteration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Promises are useful for single-shot asynchronous computations but were not suitable for use with resources of repetitive asynchronous events, such as <span style="color:#3ababa">setInterval()</span>, the “click” event in a web browser, or the “data” event on a Node stream. Because single Promises do not work for sequences of asynchronous events, we also cannot use regular <span style="color:#3ababa">async</span> functions and the <span style="color:#3ababa">await</span> statements for these things.</p><h3 id="the-forawait-loop"><span class="mr-2">The for/await Loop</span><a href="#the-forawait-loop" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/side-projects/'>Side Projects</a>, <a href='/categories/smart-food-scale/'>Smart Food Scale</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/alexa-developers/" class="post-tag no-text-decoration" >Alexa Developers</a> <a href="/tags/javascript/" class="post-tag no-text-decoration" >JavaScript</a> <a href="/tags/asynchronization/" class="post-tag no-text-decoration" >Asynchronization</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%5BJavaScript+for+Alexa+Skill+Development%5D+Chapter+13%3A+Asynchronous+features+-+Xu%27s+Blog&url=https%3A%2F%2Fyanxuceo.github.io%2Fposts%2FJavascripts_Promise%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%5BJavaScript+for+Alexa+Skill+Development%5D+Chapter+13%3A+Asynchronous+features+-+Xu%27s+Blog&u=https%3A%2F%2Fyanxuceo.github.io%2Fposts%2FJavascripts_Promise%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fyanxuceo.github.io%2Fposts%2FJavascripts_Promise%2F&text=%5BJavaScript+for+Alexa+Skill+Development%5D+Chapter+13%3A+Asynchronous+features+-+Xu%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><script src="https://giscus.app/client.js" data-repo="yanxuceo/yanxuceo.github.io" data-repo-id="R_kgDOHSdOEA" data-category="Announcements" data-category-id="DIC_kwDOHSdOEM4CO_aC" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" async> </script></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/JavaScript-visualization/">[VoiScale User Data Visualization] JavaScript, HTML and AWS Lambda code example</a><li><a href="/posts/cs110/">[Stanford CS110] Principles of Computer Systems</a><li><a href="/posts/cs144-lectures/">[CS144] Introduction to Computer Networking</a><li><a href="/posts/cs144-labs/">[CS144] Labs: build some significant pieces of the Internet</a><li><a href="/posts/OS-three-pieces/">[OS: Three Easy Pieces] Book reading - Locks</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/alexa-developers/">Alexa Developers</a> <a class="post-tag" href="/tags/operating-system/">Operating System</a> <a class="post-tag" href="/tags/computer-architecture/">computer architecture</a> <a class="post-tag" href="/tags/german-language/">German Language</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/smart-home/">Smart Home</a> <a class="post-tag" href="/tags/voiscale/">VoiScale</a> <a class="post-tag" href="/tags/asynchronization/">Asynchronization</a> <a class="post-tag" href="/tags/avs-device-sdk/">AVS-Device-SDK</a> <a class="post-tag" href="/tags/computer-networking/">computer networking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Javascripts_Object/"><div class="card-body"> <em class="small" data-ts="1673163600" data-df="ll" > Jan 8, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JavaScript for Alexa Skill Development] Chapter 6: Objects</h3><div class="text-muted small"><p> 1. Introduction to Objects An object is a composite value: it aggregates multiple value(primitive values or other objects) and allows you to store and retrieve those values by name. The methods of ...</p></div></div></a></div><div class="card"> <a href="/posts/alexa-developer/"><div class="card-body"> <em class="small" data-ts="1668788100" data-df="ll" > Nov 18, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Alexa Skill development] 0 to 1: Hands-on Alexa Voice Service</h3><div class="text-muted small"><p> Alexa Voice Service: A Developer’s Perspective AVS Device SDK on Github</p></div></div></a></div><div class="card"> <a href="/posts/alexa-APL/"><div class="card-body"> <em class="small" data-ts="1673971200" data-df="ll" > Jan 17, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Alexa APL Tutorial] Labs from Dabble Lab</h3><div class="text-muted small"><p> A very good YouTube channel Dabble Lab on Alexa APL design. Alexa developer documentation Lab1 Containers Frame layout in Container. code: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cs110/" class="btn btn-outline-primary" prompt="Older"><p>[Stanford CS110] Principles of Computer Systems</p></a> <a href="/posts/Javascripts_Object/" class="btn btn-outline-primary" prompt="Newer"><p>[JavaScript for Alexa Skill Development] Chapter 6: Objects</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/yanxuceo">xu dong</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/alexa-developers/">Alexa Developers</a> <a class="post-tag" href="/tags/operating-system/">Operating System</a> <a class="post-tag" href="/tags/computer-architecture/">computer architecture</a> <a class="post-tag" href="/tags/german-language/">German Language</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/smart-home/">Smart Home</a> <a class="post-tag" href="/tags/voiscale/">VoiScale</a> <a class="post-tag" href="/tags/asynchronization/">Asynchronization</a> <a class="post-tag" href="/tags/avs-device-sdk/">AVS-Device-SDK</a> <a class="post-tag" href="/tags/computer-networking/">computer networking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
